<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.zttek.thesis.modules.mapper.ProjectMapper">
    <cache type="org.mybatis.caches.ehcache.LoggingEhcache" >
        <property name="timeToIdleSeconds" value="3600"/><!--1 hour-->
        <property name="timeToLiveSeconds" value="3600"/><!--1 hour-->
        <property name="maxEntriesLocalHeap" value="1000"/>
        <property name="maxEntriesLocalDisk" value="10000000"/>
        <property name="memoryStoreEvictionPolicy" value="LRU"/>
    </cache>
    <resultMap id="BaseResultMap" type="cn.zttek.thesis.modules.model.Project">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="orgid" jdbcType="BIGINT" property="orgid"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="year" jdbcType="INTEGER" property="year"/>
        <result column="startdate" jdbcType="TIMESTAMP" property="startdate"/>
        <result column="enddate" jdbcType="TIMESTAMP" property="enddate"/>
        <result column="midcheckdate" jdbcType="TIMESTAMP" property="midcheckdate"/>
        <result column="submitdate" jdbcType="TIMESTAMP" property="submitdate"/>
        <result column="defensedate" jdbcType="TIMESTAMP" property="defensedate"/>
        <result column="setallowed" jdbcType="BIT" property="setallowed"/>
        <result column="getallowed" jdbcType="BIT" property="getallowed"/>
        <result column="postallowed" jdbcType="BIT" property="postallowed"/>
        <result column="mark1allowed" jdbcType="BIT" property="mark1allowed"/>
        <result column="mark2allowed" jdbcType="BIT" property="mark2allowed"/>
        <result column="mark3allowed" jdbcType="BIT" property="mark3allowed"/>
        <result column="gmpercent" jdbcType="INTEGER" property="gmpercent"/>
        <result column="rmpercent" jdbcType="INTEGER" property="rmpercent"/>
        <result column="ampercent" jdbcType="INTEGER" property="ampercent"/>
        <result column="setmax" jdbcType="INTEGER" property="setmax"/>
        <result column="setmin" jdbcType="INTEGER" property="setmin"/>
        <result column="getmax" jdbcType="INTEGER" property="getmax"/>
        <result column="doctype" jdbcType="VARCHAR" property="doctype"/>
        <result column="close" jdbcType="BIT" property="close"/>
        <result column="valid" jdbcType="BIT" property="valid"/>
        <result column="cdate" jdbcType="TIMESTAMP" property="cdate"/>
        <result column="mdate" jdbcType="TIMESTAMP" property="mdate"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from project
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" keyProperty="id" parameterType="cn.zttek.thesis.modules.model.Project" useGeneratedKeys="true">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into project (orgid, title, year,
        startdate, enddate, midcheckdate,
        submitdate, defensedate, setallowed,
        getallowed, postallowed, mark1allowed,
        mark2allowed, mark3allowed, gmpercent,
        rmpercent, ampercent, setmax,
        setmin, getmax, doctype,
        close, valid, cdate, mdate
        )
        values (#{orgid,jdbcType=BIGINT}, #{title,jdbcType=VARCHAR}, #{year,jdbcType=INTEGER},
        #{startdate,jdbcType=TIMESTAMP}, #{enddate,jdbcType=TIMESTAMP}, #{midcheckdate,jdbcType=TIMESTAMP},
        #{submitdate,jdbcType=TIMESTAMP}, #{defensedate,jdbcType=TIMESTAMP}, #{setallowed,jdbcType=BIT},
        #{getallowed,jdbcType=BIT}, #{postallowed,jdbcType=BIT}, #{mark1allowed,jdbcType=BIT},
        #{mark2allowed,jdbcType=BIT}, #{mark3allowed,jdbcType=BIT}, #{gmpercent,jdbcType=INTEGER},
        #{rmpercent,jdbcType=INTEGER}, #{ampercent,jdbcType=INTEGER}, #{setmax,jdbcType=INTEGER},
        #{setmin,jdbcType=INTEGER}, #{getmax,jdbcType=INTEGER}, #{doctype,jdbcType=VARCHAR},
        #{close,jdbcType=BIT}, #{valid,jdbcType=BIT}, #{cdate,jdbcType=TIMESTAMP}, #{mdate,jdbcType=TIMESTAMP}
        )
    </insert>
    <update id="updateByPrimaryKey" parameterType="cn.zttek.thesis.modules.model.Project">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update project
        set orgid = #{orgid,jdbcType=BIGINT},
        title = #{title,jdbcType=VARCHAR},
        year = #{year,jdbcType=INTEGER},
        startdate = #{startdate,jdbcType=TIMESTAMP},
        enddate = #{enddate,jdbcType=TIMESTAMP},
        midcheckdate = #{midcheckdate,jdbcType=TIMESTAMP},
        submitdate = #{submitdate,jdbcType=TIMESTAMP},
        defensedate = #{defensedate,jdbcType=TIMESTAMP},
        setallowed = #{setallowed,jdbcType=BIT},
        getallowed = #{getallowed,jdbcType=BIT},
        postallowed = #{postallowed,jdbcType=BIT},
        mark1allowed = #{mark1allowed,jdbcType=BIT},
        mark2allowed = #{mark2allowed,jdbcType=BIT},
        mark3allowed = #{mark3allowed,jdbcType=BIT},
        gmpercent = #{gmpercent,jdbcType=INTEGER},
        rmpercent = #{rmpercent,jdbcType=INTEGER},
        ampercent = #{ampercent,jdbcType=INTEGER},
        setmax = #{setmax,jdbcType=INTEGER},
        setmin = #{setmin,jdbcType=INTEGER},
        getmax = #{getmax,jdbcType=INTEGER},
        doctype = #{doctype,jdbcType=VARCHAR},
        close = #{close,jdbcType=BIT},
        valid = #{valid,jdbcType=BIT},
        cdate = #{cdate,jdbcType=TIMESTAMP},
        mdate = #{mdate,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=BIGINT}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select id, orgid, title, year, startdate, enddate, midcheckdate, submitdate, defensedate,
        setallowed, getallowed, postallowed, mark1allowed, mark2allowed, mark3allowed, gmpercent,
        rmpercent, ampercent, setmax, setmin, getmax, doctype, close, valid, cdate, mdate
        from project
        where id = #{id,jdbcType=BIGINT} and valid = 1
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select id, orgid, title, year, startdate, enddate, midcheckdate, submitdate, defensedate,
        setallowed, getallowed, postallowed, mark1allowed, mark2allowed, mark3allowed, gmpercent,
        rmpercent, ampercent, setmax, setmin, getmax, doctype, close, valid, cdate, mdate
        from project where valid = 1
    </select>

    <!-- =========================以下为手动添加===================================== -->
    <sql id="Base_Column_List">
        id, orgid, title, year, startdate, enddate, midcheckdate, submitdate, defensedate,
        setallowed, getallowed, postallowed, mark1allowed, mark2allowed, mark3allowed, gmpercent,
        rmpercent, ampercent, setmax, setmin, getmax, doctype, close, valid, cdate, mdate
    </sql>

    <select id="listByOrg" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from project p where p.valid = 1 and p.orgid = #{orgid}
    </select>
    <select id="getByTitleAndYear" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from project p where p.valid = 1 and p.title = #{title} and p.year = #{year}
    </select>
    <select id="getActiveCount" resultType="java.lang.Long">
        select count(id) from project p where p.valid = 1 and p.close = 0 and p.orgid = #{orgid}
    </select>

    <select id="listByUser" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from project p, (select projectid from project_${type} pt where pt.${type}id = #{uid}) as temp
        where p.valid = 1 and p.orgid = #{orgid} and p.id = temp.projectid and p.close = 0
    </select>


    <select id="listByOrgAndYear" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from project p where p.valid = 1 and p.close = 0 and p.orgid = #{orgid} and p.year = #{year}
    </select>
</mapper>